# Спецификация для заполнения CHANGELOG.md

## Общие принципы

CHANGELOG.md документирует все значимые изменения в проекте в хронологическом порядке.
Считай, что эта память проекта, по которой можно построить онтологию проекта.
Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и проект придерживается [Semantic Versioning](https://semver.org/lang/ru/).

Описание должны быть минимальным, но понятным, по сути!
Текст описания должен быть без выделения жирным текстом.
Лишняя информация делает документ большим, затрудняет чтение, не вызывает желания его читать!
Обновлять существующие данные по изменениям, не нужно.

## Структура файла

### Заголовки версий

```markdown
## [Unreleased]
## [1.2.0] - 2025-11-17
## [1.1.0] - 2025-11-16
```

- `[Unreleased]` - для изменений, которые еще не выпущены
- `[X.Y.Z]` - версия в формате Semantic Versioning (MAJOR.MINOR.PATCH)
- Дата в формате `YYYY-MM-DD`

### Категории изменений

Используйте следующие категории (в указанном порядке):

1. Added - для новых функций
2. Changed - для изменений в существующей функциональности
3. Deprecated - для функций, которые скоро будут удалены
4. Removed - для удаленных функций
5. Fixed - для исправления багов
6. Security - для исправлений уязвимостей

## Правила заполнения

### Анализ коммитов

1. Получите список коммитов с последнего тега:
   ```bash
   # Получить последний тег
   git describe --tags --abbrev=0

   # Получить коммиты с последнего тега
   git log <последний_тег>..HEAD --oneline
   ```

2. Для каждого коммита определите:
   - Тип изменения (Added, Changed, Fixed и т.д.)
   - Масштаб изменения (значимость для пользователей)
   - Затронутые компоненты

### Формат записи

```markdown
### Added
#### Компонент: краткое описание изменения
- Детали реализации (если важны)
```

### Примеры

#### Добавление новой функции
```markdown
### Added
#### API: добавлен эндпоинт `/api/v1/users/{id}` для получения информации о пользователе
- Реализован в `project/components/user/endpoints.py`
- Добавлена валидация через Pydantic схемы
```

#### Изменение существующей функциональности
```markdown
### Changed
#### Database: изменен формат хранения дат в таблице `users`
- Миграция: `alembic/versions/20251117_xxx.py`
- Обновлены модели в `project/components/user/models.py`
```

#### Исправление бага
```markdown
### Fixed
#### Auth: исправлена проверка токена при аутентификации через API
- Исправлен баг в `project/infrastructure/utils/telegram.py`
```

#### Удаление функциональности
```markdown
### Removed
#### Deprecated API: удален эндпоинт `/api/v1/old-endpoint`
- Используйте новый эндпоинт `/api/v2/new-endpoint`
```

### Группировка изменений

Группируйте изменения по компонентам или функциональным областям:

```markdown
### Added
#### Claude команды: добавлена команда `/commit` для генерации сообщений коммитов
- Создан файл `.claude/commands/commit.md`

#### Автоматизация: добавлена генерация файлов документации
- Генерация `CLAUDE.md` через `scripts/update_agents.py`
- Генерация `llms.txt` через `scripts/update_agents.py`
```

### Что включать в CHANGELOG

Включайте:
- Новые функции и возможности
- Изменения в API (breaking changes обязательно!)
- Исправления багов, влияющих на пользователей
- Изменения в конфигурации, требующие действий от пользователей
- Удаление устаревших функций
- Изменения в зависимостях (major/minor версии)

Не включайте:
- Рефакторинг без изменения поведения
- Исправления опечаток в комментариях
- Изменения в тестах (если не влияют на пользователей)
- Обновления документации без изменения функциональности
- Мелкие изменения форматирования кода

## Процесс обновления

### При создании нового релиза

1. Переместите все изменения из `[Unreleased]` в новую версию
2. Обновите дату релиза
3. Определите тип версии по изменениям:
   - MAJOR (X.0.0) - breaking changes
   - MINOR (0.X.0) - новые функции (обратно совместимые)
   - PATCH (0.0.X) - исправления багов

### Пример обновления

```markdown
## [Unreleased]

### Added
- Новая функция X

## [1.2.0] - 2025-11-17

### Added
- Новая функция X (перемещено из Unreleased)
```

## Стиль написания

- Используйте повелительное наклонение: "Добавлен", "Исправлен", "Изменен"
- Будьте конкретными: указывайте компоненты, файлы, модули
- Пишите с точки зрения пользователя: что изменилось для них
- Группируйте связанные изменения

## Автоматизация

Для генерации changelog из коммитов можно использовать:

```bash
# Получить коммиты с последнего тега с деталями
TAG=$(git describe --tags --abbrev=0)
git log $TAG..HEAD --pretty=format:"%h|%an|%ad|%s" --date=short

# Получить статистику изменений с последнего тега
git log $TAG..HEAD --stat
```

Но финальное редактирование должно быть ручным для обеспечения качества и читаемости.

