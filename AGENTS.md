# –ê–¥–∞–ø—Ç–µ—Ä—ã (Adapters)

–ê–¥–∞–ø—Ç–µ—Ä—ã ‚Äî —ç—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ —Å–ª–æ—è, 
–∫–æ—Ç–æ—Ä—ã–µ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `project/infrastructure/adapters/`

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
- –ò–∑–æ–ª–∏—Ä—É—é—Ç –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏ –∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –≤–Ω–µ—à–Ω–∏—Ö API
- –£–ø—Ä–æ—â–∞—é—Ç –∑–∞–º–µ–Ω—É –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ –¥—Ä—É–≥–∏–µ, –≤ —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ü–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–¥–º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∞–¥–∞–ø—Ç–µ—Ä–∞ –≤ —Ç–µ—Å—Ç–∞—Ö –Ω–∞ –∑–∞–≥–ª—É—à–∫–∏

## –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã

### auth.py ‚Äî –ê–¥–∞–ø—Ç–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

–ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ä–≤–∏—Å–æ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
–ó–∞–ø—Ä–æ—Å—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ prometheus.

**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- `check_telegram_user(user_telegram_id: int) -> bool` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram
- `get_users_data() -> dict` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### keycloak.py ‚Äî –ê–¥–∞–ø—Ç–µ—Ä Keycloak

–ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Keycloak (—Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –¥–æ—Å—Ç—É–ø–æ–º).

### voice.py ‚Äî –ê–¥–∞–ø—Ç–µ—Ä —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏–∏ –∏ —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏

**‚≠ê –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ**

–ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–æ–ª–æ—Å–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏: –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—á–∏ –≤ —Ç–µ–∫—Å—Ç (STT) –∏ —Ç–µ–∫—Å—Ç–∞ –≤ —Ä–µ—á—å (TTS).

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `VoiceAdapter` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OpenAI API

**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- `voice_to_text(voice: bytes | bytearray) -> str` ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–∞ –≤ —Ç–µ–∫—Å—Ç
  - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–∫–∞–∑–∞–Ω–∏–µ —è–∑—ã–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `ru`)
- `text_to_voice(text: str, instructions: str, voice: str = "alloy") -> io.BytesIO` ‚Äî —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç retry-–º–µ—Ö–∞–Ω–∏–∑–º —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ (BadRequestError, RateLimitError –∏ –¥—Ä.)
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å Prometheus —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã `@action_tracking_decorator`
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ `download_as_bytearray()`)

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
# –î–ª—è Telegram
ogg_data = await voice_file.download_as_bytearray()
text = await voice_adapter.voice_to_text(ogg_data)
```

### llm.py ‚Äî –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM

**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- `llm_chat_client() -> ChatOpenAI` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ LangChain –¥–ª—è —á–∞—Ç–∞
- `llm_aclient() -> AsyncClient` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ OpenAI –∫–ª–∏–µ–Ω—Ç–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Prometheus –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ middleware proxy –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –∫–æ–Ω—Ç—É—Ä–µ

### database.py / adatabase.py ‚Äî –ê–¥–∞–ø—Ç–µ—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ê–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç—ã).

**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ —Å –ë–î
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

TODO: –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏–π –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### cache.py / acache.py ‚Äî –ê–¥–∞–ø—Ç–µ—Ä—ã –∫ Redis

–ê–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–æ–π –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç—ã).

**–û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∫–µ—à–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TTL (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏)
- –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞

---

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Alembic
–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [Alembic](https://alembic.sqlalchemy.org/) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

#### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –º–æ–¥–µ–ª—è—Ö
alembic revision --autogenerate -m "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç—É—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision -m "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
```

#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –æ–∂–∏–¥–∞—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1
```

–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–µ—Ç–æ–∫ –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏ –≤ –≤–∞—à–∏—Ö –≤–µ—Ç–∫–∞—Ö –æ–Ω–∏ —É—à–ª–∏ –¥–∞–ª—å—à–µ, —á–µ–º –Ω–∞ –≤–µ—Ç–∫–µ, –≤ –∫–æ—Ç–æ—Ä—É—é 
–≤—ã –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å.

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Alembic –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ [alembic/README.md](alembic/README.md).

---

# –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã
- —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–∞—Ö –∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–∞—Ö, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, redis, postgres
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pickle —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é, —ç—Ç–æ –Ω–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≥–µ–Ω—Ç–∞ –ø—Ä–æ—Å—Ç–æ —Å–ª–æ–≤–∞—Ä—å, –º–∏–Ω–∏–º—É–º TypedDict, –ª—É—á—à–µ pydantic
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤, —ç—Ç–æ –Ω–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ 
  –µ—Å—Ç—å —Ä–∏—Å–∫ –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π
- –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pandas, Polars –∏ —Ç–æ–º—É –ø–æ–¥–æ–±–Ω–æ–µ.
  –ü–æ –æ–ø—ã—Ç—É –Ω–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –∏ –Ω–µ —Ö–æ—á–µ—Ç —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ –∏—Ö –∞–ø–∏, –æ–Ω–æ –ø–ª–æ—Ö–æ —á–∏—Ç–∞–µ—Ç—Å—è, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–Ω–∞–Ω–∏–µ –∏—Ö –∞–ø–∏.
  –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ —è–∑—ã–∫ SQL –∏–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –Ω–∞—Ç–∏–≤–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏, —Å–ø–∏—Å–∫–∞–º–∏ –∏ —Å–ª–æ–≤–∞—Ä—è–º–∏, –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑ 
  TypedDict, dataclass –∏ —Ç.–¥. 


### –ò–Ω—ä–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
**–ü–ª–æ—Ö–æ**: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–æ–≤ –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–π.
```python
class AskUseCase:
    def __init__(self):
        # –ñ–µ—Å—Ç–∫–∞—è —Å–≤—è–∑–∫–∞ —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π, –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞, –º–æ–≥—É—Ç –±—ã—Ç—å –µ—â–µ –º–Ω–æ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
        self.chat = ChatService(...)

    def ask(self, user_id: int, question: str) -> str:
        # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –º–æ–∫–æ–≤.
        repo = DatabaseRepository()  # –ø—Ä—è–º–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
        ...
```

–ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–∏–¥–µ—Ç—Å—è –º–æ–∫–∞—Ç—å –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ChatService –∏ DatabaseRepository:
```python
from unittes import mock

def test_ask():
    with mock.patch('path.to.ChatService'), \
        mock.patch('path.to.ChatService.create_answer'), \
        mock.patch('path.to.DatabaseRepository'):
        use_case = AskUseCase()
    ...
```

–¢–∞–∫–∏–µ —Ç–µ—Å—Ç—ã –¥–µ–ª–∞—é—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–æ–ª–µ–∑–Ω–µ–Ω–Ω—ã–º.
–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—É—Ç–µ–π, –∏–º–µ–Ω –æ–±—ä–µ–∫—Ç–æ–≤, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ –≤—Å–µ —Ç–µ—Å—Ç—ã —Å –ø–∞—Ç—á–∞–º–∏.
**–õ—É—á—à–µ —Ç–∞–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–Ω–æ—Å–∏—Ç—å —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –º–µ—Ç–æ–¥–æ–≤, –Ω–∏–∂–µ –±—É–¥–µ—Ç –ø—Ä–∏–º–µ—Ä.**

**–•–æ—Ä–æ—à–æ**: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (DI Container):
```python
from typing import Protocol

class IRepository(Protocol):  # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    def get(self): ...

class IChatService(Protocol):  # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    def create_answer(self, user_id, question): ...

class AskUseCase:
    def __init__(
        self,
        repo: IRepository,   # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
        chat: IChatService,  # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
    ):
        self.repo = repo
        self.chat = chat

    def ask(self, user_id: int, question: str) -> str:
        ...

class Repository:  # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
    def get(self):
        pass

class ChatService:  # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
    def create_answer(self, user_id, question):
        return "Answer"

class DIContainer:
    def __init__(self, repo=None, chat_service=None):
        self.repo = repo or Repository()
        self._chat = chat_service or ChatService()
        self.ask_use_case = AskUseCase(self.repo, self._chat)

container = DIContainer()
assert container.ask_use_case.ask(user_id=1, question="My question") == "Answer"

class OtherChatService:  # –î—Ä—É–≥–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    def create_answer(self, user_id, question):
        return "Other Answer"

other_container = DIContainer(chat_service=OtherChatService)
assert other_container.ask_use_case.ask(user_id=1, question="My question") == "Other Answer"
```

–¢–∞–∫–æ–π –∫–ª–∞—Å—Å –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –±–µ–∑ –º–æ–∫–æ–≤:
```python
def test_ask_use_case():
    user_id = 1
    question_text = "Test question"
    expected_answer = "Test answer"

    class TestRepo:
        def get(self):
            return user_id

    class TestChatService:
        def create_answer(self, user_id, question):
            return expected_answer

    use_case = AskUseCase(
        repository=TestRepo(),
        chat=TestChatService(),
    )

    result = use_case.ask(user_id, question_text)

    assert result == expected_answer
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–¥—Ö–æ–¥–∞**:
1. –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–∞—Ç—á–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
2. –Ø–≤–Ω–æ –≤–∏–¥–Ω—ã –≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –¥–∞–Ω–Ω—ã–µ
3. –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω–æ–µ API –∫–ª–∞—Å—Å–∞
4. –ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Ä–∞–±–æ—á–∏–º

–í–∏–¥–µ–æ –ø—Ä–æ —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É https://www.youtube.com/watch?v=3Z_3yCgVKkM

---

# –ê–≤—Ç–æ—Ç–µ—Å—Ç—ã
- –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ –≤ [README.md](../../README.md)
- –§–∏–∫—Å—Ç—É—Ä—ã –≤ [conftest.py](tests/conftest.py).
- –ß–µ—Ä–µ–∑ testconteiners –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ [pytest.ini](pytest.ini)
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–π —Å –ë–î –∏ –∫–ª–∏–µ–Ω—Ç FastAPI –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º 

–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ API [test_endpoints.py](tests/test_domains/test_chat/test_endpoints.py).

##  –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –≤ —Ç–µ—Å—Ç–∞—Ö
- –±–æ–ª—å—à–æ–µ –∫–æ–ª-–≤–æ assert –≤ —Ç–µ—Å—Ç–µ —ç—Ç–æ –ø–ª–æ—Ö–æ, –Ω–∞–∏–ª—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç, –æ–¥–∏–Ω assert –Ω–∞ –æ–¥–∏–Ω —Ç–µ—Å—Ç
- —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã, —ç—Ç–æ –ø–ª–æ—Ö–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∏–∑–º–µ–Ω—è—Ç—å —Ç–µ—Å—Ç—ã, –∞ —ç—Ç–∏–º –Ω–∏ –∫—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å—Å—è, 
  –ø–æ—ç—Ç–æ–º—É –±—É–¥–µ—Ç –∑–∞—Ç—Ä—É–¥–Ω—è—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —Å–≤–µ—Ä—Ö—É, —á–µ—Ä–µ–∑ UseCase –∏–ª–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã)
- –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∞, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–Ω—É—Ç—Ä–∏ —Ç–µ—Å—Ç–∞, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
- –∑–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å unittest.mock.patch, –µ—Å–ª–∏ –æ–Ω –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏–ª—Å—è, –∑–Ω–∞—á–∏—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–µ–≤–µ—Ä–Ω–æ, 
  –ø–µ—Ä–µ–ø–∏—à–∏—Ç–µ –∫–æ–¥, —Å–ª–µ–¥—É—è –ø—Ä–∏–Ω—Ü–∏–ø—É dependency inversion, —á—Ç–æ–±—ã –ø–æ–¥–º–µ–Ω–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –æ–±—ä–µ–∫—Ç–∞ –≤ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–º –∫–æ–¥–µ –±–µ–∑ –ø–∞—Ç—á–∞ 

## –§–∞–±—Ä–∏–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –º–æ–¥–µ–ª–∏ ORM –≤ —Ç–µ—Å—Ç–∞—Ö
–ü–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
–ù–∞—Ö–æ–¥—è—Ç—Å—è –≤ [factories.py](tests/factories.py)

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ [test_ask.py](tests/test_domains/test_chat/test_ask.py)

–í —Ç–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–Ω–∞ —Å–µ—Å—Å–∏—è SqlAlchemy —Å –ë–î, –ø–æ—ç—Ç–æ–º—É –æ–±—ä–µ–∫—Ç—ã –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ñ–∞–±—Ä–∏–∫–æ–π –≤ –ë–î, –Ω–æ
–±–ª–∞–≥–æ–¥–∞—Ä—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É ORM, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤–∏–¥–∏—Ç —ç—Ç–∏ –æ–±—ä–µ–∫—Ç—ã.

–ì–¥–µ –æ–±—ã—á–Ω–æ —Å–æ–∑–¥–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∞? –í —Ñ–∏–∫—Å—Ç—É—Ä–∞—Ö.
–ü–æ—Ç–æ–º –∏—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏ –≤ –¥—Ä—É–≥–∏—Ö —Ç–µ—Å—Ç–∞—Ö.
–ß—Ç–æ–± —Å–æ–∑–¥–∞—Ç—å –Ω–µ–º–Ω–æ–≥–æ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ, —Å–æ–∑–¥–∞–µ—Ç –µ—â–µ —Ñ–∏–∫—Å—Ç—É—Ä—É –∏ —Ç–∞–∫ –ø—Ä–æ–µ–∫—Ç –∏–º–∏ –∑–∞—Ä–∞—Å—Ç–∞–µ—Ç.

–§–∞–±—Ä–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏—Ö –±–æ–ª–µ–µ –≥–∏–±–∫–∏–º–∏.
–û–¥–Ω–∞ —Ñ–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.
–ü–æ–ª–µ–∑–Ω–æ, –∫–æ–≥–¥–∞ –≤–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –≤ —Ç–µ—Å—Ç–∞—Ö.

–§–∞–±—Ä–∏–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞, —Ç–∞–∫ –∫–∞–∫ –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã.

–§–∞–±—Ä–∏–∫–∏ —É–ø—Ä–æ—â–∞—é—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–¥–∞, —Ç–∞–∫ –∫–∞–∫ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.
–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞, –≤—ã –¥–µ–ª–∞–µ—Ç–µ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –≤ —Ñ–∞–±—Ä–∏–∫–µ, –∞ –Ω–µ –≤ –∫–∞–∂–¥–æ–º —Ç–µ—Å—Ç–µ.

–§–∏–∫—Å—Ç—É—Ä—ã –≤ `pytest` –º–æ–≥—É—Ç –±—ã—Ç—å "–º–∞–≥–∏—á–µ—Å–∫–∏–º–∏" ‚Äî –æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ —Ç–µ—Å—Ç—ã,
—á—Ç–æ –º–æ–∂–µ—Ç –∑–∞—Ç—Ä—É–¥–Ω–∏—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.
–§–∞–±—Ä–∏–∫–∏, —è–≤–Ω–æ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –≤ –∫–æ–¥–µ, —É–ª—É—á—à–∞—è –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞.

–§–∞–±—Ä–∏–∫–∏ –ª—É—á—à–µ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤,
–≥–¥–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏–ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏.
–§–∏–∫—Å—Ç—É—Ä—ã –º–æ–≥—É—Ç —Å—Ç–∞—Ç—å –≥—Ä–æ–º–æ–∑–¥–∫–∏–º–∏ –≤ —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö.

TODO: –æ–ø–∏—Å–∞—Ç—å —Ñ–∏–∫—Å—Ç—É—Ä—ã, —Ñ–∞–±—Ä–∏–∫–∏ —Å—Ç–∞–±—ã –∏ –º–æ–∫–∏ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
TODO: –ö–∞–∫ –ø–æ–¥–º–µ–Ω—è—Ç—å –æ—Ç–≤–µ—Ç—ã HTTP –∑–∞–ø—Ä–æ—Å–æ–≤.

---

# –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∞–¥–∞–ø—Ç–µ—Ä –∫ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–µ

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–∞–ø—Ç–µ—Ä–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å –≤–Ω–µ—à–Ω–∏–º–∏ HTTP API, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª–∞—Å—Å—ã –∏–∑ [base_client.py](../../project/infrastructure/utils/base_client.py).

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **AsyncApi** ‚Äî –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö HTTP –∫–ª–∏–µ–Ω—Ç–æ–≤
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç context manager –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (4xx, 5xx)
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus –º–µ—Ç—Ä–∏–∫–∞–º–∏
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

2. **SyncApi** ‚Äî –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö HTTP –∫–ª–∏–µ–Ω—Ç–æ–≤
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å AsyncApi
   - –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

3. **IClient** ‚Äî Protocol, –æ–ø—Ä–µ–¥–µ–ª—è—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–ª–∏–µ–Ω—Ç–∞
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫–ª–∞—Å—Å–∞
   - –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤

### –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∞–¥–∞–ø—Ç–µ—Ä–∞

#### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –∞–¥–∞–ø—Ç–µ—Ä–∞

–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ `project/infrastructure/adapters/`, –Ω–∞–ø—Ä–∏–º–µ—Ä `my_service.py`.

#### –®–∞–≥ 2: –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```python
from project.exceptions import ApiError, ServerError, ClientError

class MyServiceApiError(ApiError):
    pass

class MyServiceServerError(ServerError):
    pass

class MyServiceClientError(ClientError):
    pass
```

#### –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å –∞–¥–∞–ø—Ç–µ—Ä–∞

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä**

```python
from project.infrastructure.utils.base_client import AsyncApi, IClient

class MyServiceClient(IClient):
    class Api(AsyncApi):
        ApiError = MyServiceApiError
        ServerError = MyServiceServerError
        ClientError = MyServiceClientError
        # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∫–∞—Å—Ç–æ–º–Ω–∞—è —Å–µ—Å—Å–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        # ClientSession = MyCustomHttpClient

    def __init__(self, api_key: str):
        self.api_root = "https://api.myservice.com"
        self.api = self.Api(
            self.api_root,
            name_for_monitoring="my_service_api",
            headers={"Authorization": f"Bearer {api_key}"},
            request_settings={"timeout": 30},
        )

    async def get_items(self, resource_id: str) -> dict:
        """–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å–∞."""
        return await self.api.call_endpoint(
            f"path/to/resource/{resource_id}",
            method="GET",
            request_settings={"timeout": 3} # example timeout for resource
        )

    async def create_items(self, data: dict) -> dict:
        """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ä–µ—Å—É—Ä—Å."""
        return await self.api.call_endpoint(
            "path/to/resource/",
            method="POST",
            json=data,
        )
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä**

```python
from project.infrastructure.utils.base_client import SyncApi

class MyServiceSyncClient:
    class Api(SyncApi):
        ApiError = MyServiceApiError
        ServerError = MyServiceServerError
        ClientError = MyServiceClientError

    def __init__(self, api_key: str):
        self.api_root = "https://api.myservice.com"
        self.api = self.Api(
            self.api_root,
            name_for_monitoring="my_service_api",
            headers={"Authorization": f"Bearer {api_key}"},
        )

    def get_items(self, resource_id: str) -> dict:
        return self.api.call_endpoint(
            f"resources/{resource_id}",
            method="GET",
        )
```

#### –®–∞–≥ 4: –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–±—Ä–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

```python
from functools import cache
from project.settings import Settings

@cache
def my_service_client():
    return MyServiceClient(
        api_key=Settings().MY_SERVICE_API_KEY.get_secret_value()
    )
```

#### –®–∞–≥ 5: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–¥–∞–ø—Ç–µ—Ä–∞

```python
from project.infrastructure.adapters.my_service import my_service_client

client = my_service_client()
data = await client.get_items("123")

# –° –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏ (–¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
async with client.api.Session():
    data1 = await client.get_items("123")
    data2 = await client.get_items("456")
    # –°–µ—Å—Å–∏—è –±—É–¥–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### –ö–∞—Å—Ç–æ–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –º–µ—Ç–æ–¥—ã –≤ Api –∫–ª–∞—Å—Å–µ:

```python
class LimitError(MyServiceClientError):
    pass

class MyServiceClient(IClient):
    class Api(AsyncApi):
        async def response_to_native(self, response):
            # –ö–∞—Å—Ç–æ–º–Ω–∞—è –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
            return await super().response_to_native(response)
        
        async def error_handling(self, response, response_data):
            # –ö–∞—Å—Ç–æ–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            if response.status == 429:
                raise LimitError("LimitError: Too many requests.")
            
            return await super().error_handling(response, response_data)
```

#### Retry-–º–µ—Ö–∞–Ω–∏–∑–º

–î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –¥–æ–±–∞–≤—å—Ç–µ retry:

```python
from project.libs.retry import retry_on_exception

class MyServiceClient(IClient):
    # ... (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Api –∫–ª–∞—Å—Å–∞)

    @retry_on_exception(
        (LimitError,),
        max_attempts=3,
        backoff=2,
    )
    async def create_item(self, data: dict):
        ...
```

---

# Exceptions
–°–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–∞—Å–ª–µ–¥—É–π—Ç–µ –æ—Ç `project.exceptions.AppError`

---

## API Best practices
uvicorn –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å —Ü–∏–∫–ª–æ–º uvloop
```bash
uvicorn project.presentation.api:app -host 0.0.0.0 --loop uvloop
```

–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –≤ `project.domains.{name}.endpoints`.

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ —Ä–µ—Å—É—Ä—Å–æ–≤ API
–õ—É—á—à–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä—è.
–¢–æ–≥–¥–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–≤–µ—Ç–µ —Ä—É—á–∫–∏, –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤–æ–µ –ø–æ–ª–µ.
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—É—é —Å—Ö–µ–º—É –¥–ª—è —ç—Ç–æ–≥–æ `project.domains.base.schemas.BaseResponse`.
–ï—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–µ response_model, –≤ swagger –ø–æ—è–≤–∏—Ç—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤—ã–≤–æ–¥—É.
–ù–æ –≤ —Å–ª—É—á–∞–µ —Ç—è–∂–µ–ª—ã—Ö –¥–∞–Ω–Ω—ã—Ö —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞—Ç—Ä–∞—Ç–Ω–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏,
–ø–æ—Ç–æ–º—É —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ `pydantic`, —ç—Ç–æ –∑–∞–º–µ–¥–ª—è–µ—Ç 2.5 —Ä–∞–∑–∞ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ–±—ã—á–Ω—ã–º dict/dataclass.

```python
from project.domains.base.schemas import BaseResponse

@app.get("/my", response_model=BaseResponse[list[int]])
async def my_resource():
    return {"data": [1, 2]}
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —Ç–æ–∫–µ–Ω—É –≤ API
–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–∂–µ –∑–∞—à–∏—Ç–∞ –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.
```python
def auth_by_token(auth_token: str = Header(alias="Api-Token")):
    if auth_token != Settings().API_TOKEN:
        raise HTTPException(status_code=status.HTTP_401_UNAUTHORIZED, detail="Invalid Token")
    return auth_token

app = FastAPI(..., dependencies=[Depends(auth_by_token)])
```

### –ë—ã—Å—Ç—Ä–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ JSON
 `ORJSONResponse` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞–∫–µ—Ç `orjson` –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ `RUST`, –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π.
–ú–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Å–∞–º–æ–π —Ä—É—á–∫–µ —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç `response_class`.

```python
from fastapi.responses import ORJSONResponse

@app.get("/health", response_class=ORJSONResponse)
async def health_check():
    return {}
```

### –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ URL –ø—É—Ç—å `/user/v1/list`
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä—É—á–µ–∫ –¥–µ–ª–∞–µ–º —á–µ—Ä–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ä—É—á–∫–∏ —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π, –∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–æ–º–µ—á–∞–µ–º `deprecated`.
```
@app.get("/user/v1/list", deprecated=True)
```

### –û—à–∏–±–∫–∏ HTTP
–ù–µ –Ω—É–∂–Ω–æ —Ç–∞—â–∏—Ç—å `fastapi.exceptions.HTTPException` –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ –º–æ–¥—É–ª—è—Ö `endpoints.py`.

---

# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã

TODO: –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å

–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å —Å–ª–æ–∏—Å—Ç—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä - –æ—Ç–¥–µ–ª–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤, –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞.

–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - —ç—Ç–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, ORM, –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–µ–º—É —Å–µ—Ä–≤–∏—Å—É, —à–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, –æ—Ç–ø—Ä–∞–≤–∫–∞
—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∏ —Ç.–¥.

–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –¥–µ—Ç–∞–ª–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –±—ã—Ç—å –ø–æ–¥–∞–ª—å—à–µ –æ—Ç –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.
–î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ –∏–Ω–≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π,
–Ω–∏–∂–µ–ª–µ–∂–∞—â–∏–µ —Å–ª–æ–∏ –Ω–µ –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –≤—ã—à–µ—Å—Ç–æ—è—â–∏—Ö.

–ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ –≤ Python —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ —Å–ª–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç–æ–≤
–∏–∑ —Å–ª–æ—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞.
–ß—Ç–æ–±—ã –æ–±–æ–∑–Ω–∞—á–∏—Ç—å –æ–∂–∏–¥–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—ä–µ–∫—Ç–æ–≤ –∏–∑ —Å–ª–æ—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è—Ö —Ç–∏–ø–æ–≤, –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—è –∏—Ö,
–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–≥–ª—É—à–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞—Å–ª–µ–¥—É—è—Å—å –æ—Ç –∫–ª–∞—Å—Å–∞ `Protocol`.
–ü—Ä–∏–º–µ—Ä –≤ [interfaces.py](project/domains/chat/interfaces.py)

–ò–∑-–∑–∞ —Ç–æ–≥–æ, —á—Ç–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–µ—Ç–∞–ª–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, —É–ø—Ä–æ—â–∞–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ç—É—Ç [test_ask.py](tests/test_domains/test_chat/test_ask.py)

–ü—Ä–∏–º–µ—Ä, –∫–∞–∫ –Ω–∞–¥–æ –ø–∏—Å–∞—Ç—å –º–æ–¥—É–ª–∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –¥–æ–º–µ–Ω–∞ [chat](project/domains/chat)

## –°–ª–æ–∏

–°—á–∏—Ç–∞—é, —á—Ç–æ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ UseCase, Service, Repository
–º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º–∏ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞ —Ä–∞–Ω–Ω–µ–π —Å—Ç–∞–¥–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.
–í–≤–æ–¥–∏—Ç—å –Ω–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –ø–æ –º–µ—Ä–µ —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.
–ü–æ—ç—Ç–æ–º—É –æ–≥—Ä–∞–Ω–∏—á–∏–º—Å—è –æ–ø–∏—Å–∞–Ω–∏–µ–º —ç—Ç–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤.

**UseCase** - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏–∏. –ü—Ä–∏–º–µ—Ä [use_cases.py](project/domains/chat/use_cases.py).
–°–ª–æ–π, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞ –∑–∞–ø—É—Å–∫–∞—é—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.
–ó–¥–µ—Å—å —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–æ—Ç—ã, –ª–∏–º–∏—Ç–æ–≤ –∏ —Ç.–¥.
–ü–æ—ç—Ç–æ–º—É –¥—Ä—É–≥–∏–µ –¥–æ–º–µ–Ω—ã –∏ –ø–æ–¥–¥–æ–º–µ–Ω—ã –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `UseCase`.
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–æ–ª–∂–Ω–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `Service`-–∞—Ö.
–í `UseCase` –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–æ–≥–æ, —á—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤ `Service`-–∞—Ö –≤ –¥—Ä—É–≥–∏—Ö –¥–æ–º–µ–Ω–∞—Ö –∏ –ø–æ–¥–¥–æ–º–µ–Ω–∞—Ö.
–ò–º—è —Å—Ü–µ–Ω–∞—Ä–∏—è –¥–æ–ª–∂–Ω–æ –æ—Ç—Ä–∞–∂–∞—Ç—å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—é.
–û–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ `UseCase` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç—ã–º (–º–∞–ª–æ —Å—Ç—Ä–æ–∫) –∏ –ø–æ–Ω—è—Ç–Ω—ã–º –¥–ª—è —á—Ç–µ–Ω–∏—è.
–°–∞–º –∫–æ–¥, –Ω–µ–π–º–∏–Ω–≥ –∫–ª–∞—Å—Å–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤ –¥–æ–ª–∂–µ–Ω –æ–ø–∏—Å—ã–≤–∞—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö –±–∏–∑–Ω–µ—Å–∞ -
–ø—Ä–æ–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –∫–≤–æ—Ç—É, –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å.
–í–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞ —ç—Ç–æ–º —Å–ª–æ–µ,
–Ω–æ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—Ñ—É–Ω–∫—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–π) –≤—ã–Ω–æ—Å–∏—Ç—å –≤ –º–æ–¥—É–ª—å `validation.py`

`UseCase` - —ç—Ç–æ –æ–±—ä–µ–∫—Ç –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

**Service** - —Å–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–∞. –ü—Ä–∏–º–µ—Ä [service.py](project/domains/chat/service.py)
–ú–æ–∂–µ—Ç –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –≤ —Å–µ–±–µ —Ä–∞–±–æ—Ç—É –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–º–µ–Ω–æ–≤.\
–û–±—ä–µ–∫—Ç –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

**Repository** - –Ω—É–∂–Ω—ã, —á—Ç–æ–±—ã –æ—Ç–¥–µ–ª–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –æ—Ç ORM. –ü—Ä–∏–º–µ—Ä [repositories.py]
(project/domains/chat/repositories.py)\
–û–±—ä–µ–∫—Ç –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

- –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –∏–∑–æ–ª–∏—Ä—É–π—Ç–µ –≤ –∫–ª–∞—Å—Å–∞—Ö Repository, –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–¥ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç 
  —á–∏—Ç–∞—Ç—å –∏ –ø–æ–Ω–∏–º–∞—Ç—å —Å–∞–º—É –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É. –ò—â–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –≤ –º–æ–¥—É–ª—è—Ö [repositories.py](project/domains/user/repositories.py)
- –ï—Å—Ç—å generic –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Å –±–∞–∑–æ–≤—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏, –Ω–∞—Å–ª–µ–¥—É–π—Ç–µ –≤–∞—à–∏ Repository –æ—Ç –Ω–µ–≥–æ, –ø—Ä–∏–º–µ—Ä –≤ [repositories.py](project/domains/user/repositories.py)

```python
# –ö–æ–≥–¥–∞ –º—ã —Å–º–æ—Ç—Ä–∏–º –Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –ª—É—á—à–µ —É–≤–∏–¥–µ—Ç—å —Ç–∞–∫–æ–µ
UserRepo.get_users(user_ids=[1, 2, 3])
# —á–µ–º —Ç–∞–∫–æ–µ
query = select(User).where(User.id.in_([1, 2, 3]))
async with Session() as session:
    result = session.execute(query)
    data = await result.scalars().all()
```

**Interface** - —ç—Ç–æ –æ–±—ä–µ–∫—Ç, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π –æ–∂–∏–¥–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è—Ö —Ç–∏–ø–æ–≤.
–ü—Ä–∏–º–µ—Ä [interfaces.py](project/domains/chat/interfaces.py).
–ò–∑–±–∞–≤–ª—è–µ—Ç –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–º–ø–æ—Ä—Ç–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞,
—á—Ç–æ–±—ã –Ω–µ –Ω–∞—Ä—É—à–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ –∏–Ω–≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

**Adapter** - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –ü—Ä–∏–º–µ—Ä [llm.py](project/infrastructure/adapters/llm.py).
–ß—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π,
–º—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ–º —Å –Ω–∏–º–∏ —á–µ—Ä–µ–∑ —Ñ–∞—Å–∞–¥.
–ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é, –Ω–∞—Ö–æ–¥—è—â—É—é—Å—è –∑–∞ —Ñ–∞—Å–∞–¥–æ–º.

**DIContainer** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑.
–ü—Ä–∏–º–µ—Ä [container.py](project/container.py).
–ó–Ω–∞–µ—Ç –∫–æ–º—É, –∫–∞–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω—É–∂–Ω—ã –∏ –æ—Ç–∫—É–¥–∞ –∏—Ö –≤–∑—è—Ç—å.
–ò–∑–±–∞–≤–ª—è–µ—Ç –Ω–∞—Å –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥—É–º–∞—Ç—å, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç.
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤ –æ–¥–Ω–æ–π **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –∏–∑–º–µ–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥–µ–ª–µ–π, —Ç.–µ. –≤–Ω–µ –≥—Ä–∞–Ω–∏—Ü —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–æ–º–µ–Ω–∞,
–ª—É—á—à–µ —Å–æ–∑–¥–∞–π—Ç–µ –µ—â–µ –æ–¥–∏–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —ç—Ç–æ–≥–æ.

## –õ–∏–Ω—Ç–µ—Ä —Å–ª–æ–µ–≤
–ï—Å—Ç—å –ª–∏–Ω—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ñ–∏–≥–µ [layers.toml](../../layers.toml).
–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 
```bash
layers-linter project
```

---

# –ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã

–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã —ç—Ç–æ —Ç–æ–ø –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω, –¥–∞–ª—É—é—â–∏–π –ø—Ä–æ–≥—Ä–∞–º–º—É –∫—Ä–∞–π–Ω–µ –ø–ª–æ—Ö–æ–π (TODO: –Ω–∞–ø–∏—Å–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø–æ—á–µ–º—É).

–í–º–µ—Å—Ç–æ –Ω–∏—Ö —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç—ã —Å –ª–µ–Ω–∏–≤–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π (–≤ –º–æ–º–µ–Ω—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞)

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –∏ —á–∞—Å—Ç—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —ç—Ç–æ —Å–æ–∑–¥–∞—Ç—å —Ñ–Ω—É–∫—Ü–∏—é —Å –∫–µ—à–æ–º.
–¢–∞–º –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç, –≤—ã –≤—ã–∑—ã–≤–∞–µ—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –∏ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ–±—ä–µ–∫—Ç, —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ª–æ–∂–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –¥–æ 
–º–æ–º–µ–Ω—Ç–∞ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

```python
from functools import cache
from langchain_openai import ChatOpenAI
from project.settings import Settings

@cache
def client():
    return ChatOpenAI(
        api_key=Settings().LLM_API_KEY.get_secret_value(),
    )

async def llm_logic():
    result = await client().ainvoke()
```

–ï—Å–ª–∏ –≤ —Ç–µ—Å—Ç–∞—Ö –Ω—É–∂–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, —Ç–æ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
`LazyInit` –∏–∑ [structures.py](project/libs/structures.py), –æ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –º–µ—Ö–∞–Ω–∏–∑–º –ª–µ–Ω–∏–≤–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ 
–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–∞ —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.

–ü—Ä–∏–º–µ—Ä —Ç–∞–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–ª–∞—Å—Å–∞ [Settings](project/settings.py), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º –ø–æ–ª—É—á–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ 
–æ–∫—Ä—É–∂–µ–Ω–∏—è, –∞ –≤ —Ç–µ—Å—Ç–∞—Ö –º—ã —Ö–æ—Ç–∏–º –∑–∞–º–µ–Ω—è—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞
class MyServiceClass:
    def __init__(self, param):
        self.param = param
        
    def do_something(self):
        return self.param

MyService = LazyInit(MyServiceClass, kwargs_func=lambda: {"param": Settings().PARAM})

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
result = MyService().do_something()

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
my_service = MyService()  # ‚ùå –ü–õ–û–•–û
my_service.do_something()

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∞—Ç—Ä–∏–±—É—Ç–∞—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è –ª–µ–Ω–∏–≤–æ.
class MyClass:
    def __init__(self):
        self.adapter = GitLabAdapter()
        
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –í—ã–∑–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –ª–µ–Ω–∏–≤–æ
def myfunc():
    x = MyService().do_something()
```

---

# –ó–∞–ø—É—Å–∫ –ª–∏–Ω—Ç–µ—Ä–æ–≤

- ruff check --fix (–ª–∏–Ω—Ç–µ—Ä)
- ruff format (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- di-linter (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—ä–µ–∫—Ü–∏–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
- la-linter (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Å–ª–æ–µ–≤)
- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ requirements.txt —á–µ—Ä–µ–∑ UV

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å layers-linter
–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [layers-linter](https://github.com/pavelmaksimov/layers-linter)
–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü –º–µ–∂–¥—É —Å–ª–æ—è–º–∏.

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ [layers.toml](layers.toml), –≥–¥–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã:
- –°–ª–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (dicontainer, usecases, services, repo, orm, adapters –∏ —Ç.–¥.)
- –ú–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—Ö–æ–¥—è—Ç –≤ –∫–∞–∂–¥—ã–π —Å–ª–æ–π
- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É —Å–ª–æ—è–º–∏ (–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Å–ª–æ–µ–≤ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—è)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –≤ —Å–ª–æ—è—Ö

–ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
layers-linter project
```

–õ–∏–Ω—Ç–µ—Ä –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–º–ø–æ—Ä—Ç—ã –≤ –∫–æ–¥–µ –∏ –≤—ã—è–≤–ª—è–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü:
1. –ö–æ–≥–¥–∞ –º–æ–¥—É–ª—å –∏–∑ –æ–¥–Ω–æ–≥–æ —Å–ª–æ—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–æ–¥—É–ª—å –∏–∑ —Å–ª–æ—è, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –µ–º—É –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –∑–∞–≤–∏—Å–µ—Ç—å
2. –ö–æ–≥–¥–∞ –º–æ–¥—É–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω–µ—à–Ω—é—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É, –∫–æ—Ç–æ—Ä—É—é –¥–ª—è –Ω–µ–≥–æ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —á–∏—Å—Ç–æ—Ç—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É —Å–ª–æ—è–º–∏.

---

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ï—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –º–µ—Ç—Ä–∏–∫ —Å–æ–±–∏—Ä–∞–µ–º—ã—Ö –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ —á–µ—Ä–µ–∑ Prometheus.
–ú–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —É –∫–æ–ª–ª–µ–≥ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ –¥–µ–≤–æ–ø—Å–æ–≤.
–¢–∞–∫–∂–µ –Ω–∞ —ç—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –≤ –¥–∞—à–±–æ—Ä–¥–∞—Ö –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –≤ —Ç–µ–ª–µ–≥—Ä–∞–º

–î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–µ–∫—Ü–∏–π –∫–æ–¥–∞.
–î–ª—è Telegram –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ callback –µ—Å–ª–∏ —ç—Ç–æ telegram –±–æ—Ç.

## –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–µ–∫—Ü–∏–π –∫–æ–¥–∞

–î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä.

–ß—Ç–æ–±—ã —ç—Ç–∏ –ø—Ä–∏–º–∏—Ç–∏–≤—ã —Å–º–æ–≥–ª–∏ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –≤–æ–∑–Ω–∏–∫–ª–æ–≤–∞–Ω–∏—è exception, –≤–Ω—É—Ç—Ä–∏ —ç—Ç–∏—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –¥–æ–ª–∂–Ω—ã
–ø–æ–¥–∞–≤–ª—è—Ç—å—Å—è exception.

```python
from llm_common.prometheus import action_tracking, action_tracking_decorator

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–∞
with action_tracking("data_processing") as tracker:
    # –í–∞—à –∫–æ–¥
    processed_data = process_data()
    # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ç—Ä–µ–∫–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
    tracker.size(len(processed_data))
    
    # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ –æ—à–∏–±–∫—É
    tracker.to_fail()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
@action_tracking_decorator("myfeature_llm_call")
async def make_llm_request():
    # –í–∞—à –∫–æ–¥
    return result
```

## –ë–æ—Ç—ã Telegram

–•–æ—Ä–æ—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π —è–≤–ª—è–µ—Ç—Å—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤.

–ü—Ä–∏–º–µ–Ω—è–π–µ—Ç—Å—è –Ω–∞ —Ö–µ–Ω–¥–ª–µ—Ä—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback –∫–Ω–æ–ø–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –∏–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä—ã action_tracking –∏ action_tracking_decorator
–í –∫–∞—á–µ—Å—Ç–≤–µ –∏–º–µ–Ω–∏ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å—É—Ñ—Ñ–∏–∫—Å "_handler" action_tracking(name="menu_handler"), —ç—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –æ—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –Ω–∞ 
–≥—Ä–∞—Ñ–∏–∫–µ —Ç–æ–ª—å–∫–æ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤

## –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö action

–î–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ Telegram, —Å—É—Ñ—Ñ–∏–∫—Å "_handler"
–î–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –∑–∞–¥–∞—á, —Å—É—Ñ—Ñ–∏–∫—Å "_task"
–î–ª—è –≤—ã–∑–æ–≤–æ–≤ llm, —Å—É—Ñ—Ñ–∏–∫—Å "_llm_call"
–î–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–≥–µ–Ω—Ç–∞ llm, —Å—É—Ñ—Ñ–∏–∫—Å "_agent"

–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è –∏–º–µ–Ω: "_"

## üìñ API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### action_tracking(name: str)
–ö–æ–Ω—Ç–µ–∫—Å—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–º–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –∏ –æ—à–∏–±–æ—á–Ω—ã–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç—Ä–µ–∫–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### action_tracking_decorator(name: str)
–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–æ—Ä—É—Ç–∏–Ω, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ `action_tracking`.

## üîç –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

–í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `genapp_`:

#### HTTP –º–µ—Ç—Ä–∏–∫–∏:
- `genapp_http_requests_total` - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `genapp_http_request_duration_sec` - –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `genapp_http_request_size_bytes` - –†–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤

#### –ú–µ—Ç—Ä–∏–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π:
- `genapp_action_count_total` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- `genapp_action_duration_sec` - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π
- `genapp_action_size_total` - –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### Labels (—Ç–µ–≥–∏)

–ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç labels:
- http_requests_total ‚Üí method, status, resource, app_type, env, app
- http_request_duration_sec ‚Üí method, status, resource, app_type, env, app
- http_request_size_bytes ‚Üí resource, status, method, direction, app_type, env, app
- action_count_total ‚Üí name, status, env, app
- action_duration_sec ‚Üí name, env, app
- action_size_total ‚Üí name, env, app

---

–ü—Ä–æ —É—Ç–∏–ª–∏—Ç—ã
- –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∫–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç [fsm.py](../../project/libs/fsm.py) (–º–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π, FSM).
  TODO: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

TODO: –æ–ø–∏—Å–∞—Ç—å –¥—Ä—É–≥–∏–µ —É—Ç–∏–ª–∏—Ç—ã

---

# –ü—Ä–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

## Alembic
- Alembic –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## uvloop
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø—Ä–∏–æ–∂–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ uvloop.
–û–Ω –≥–æ—Ä–∞–∑–¥–æ –±—ã—Å—Ç—Ä–µ–µ.

## –õ–∏–Ω—Ç–µ—Ä—ã
–ø—Ä–æ –Ω–∏—Ö –Ω–∞–ø–∏—Å–∞–Ω–æ –≤ [linters.md](linters.md)

## python-telegram-bot
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–æ–≤

## FastAPI
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è API

TODO: –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ –¥—Ä—É–≥–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

---

# –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ project.settings.Settings

TODO: —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ SecretStr

## –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Settings

–û–±—ä–µ–∫—Ç `Settings` –≤ —Ñ–∞–π–ª–µ `project/settings.py` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ `LazyInit`
–∏ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è **—Ç–æ–ª—å–∫–æ** —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ –∫–ª–∞—Å—Å–∞ `Settings().param_name`.

–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –ª–µ–Ω–∏–≤–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏
–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

### 1. –õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
`LazyInit` —Å–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏
–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- –û—Ç–ª–æ–∂–µ–Ω–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏!
- –≠–∫–æ–Ω–æ–º–∏—é –ø–∞–º—è—Ç–∏
- –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ `Settings.local(**kwargs)`

## ‚ùå –ê–ù–¢–ò–ü–ê–¢–¢–ï–†–ù–´ - —á—Ç–æ –ù–ï –Ω–∞–¥–æ –¥–µ–ª–∞—Ç—å

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
settings = Settings()
model_name = settings.LLM_MODEL_NAME
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- –ù–∞—Ä—É—à–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –ª–µ–Ω–∏–≤–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏!
- –°–æ–∑–¥–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—É—é —Å—Å—ã–ª–∫—É –Ω–∞ –æ–±—ä–µ–∫—Ç
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –£—Å–ª–æ–∂–Ω—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö —Ñ—É–Ω–∫—Ü–∏–π
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
def process_data(settings=Settings()):
    return settings.MAX_TOKENS

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
def create_agent(config: SettingsValidator = Settings()):
    pass
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- –°–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞ –º–æ–º–µ–Ω—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏, –∞ –Ω–µ –≤—ã–∑–æ–≤–∞
- –ù–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã
- –î–µ–ª–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –º–µ–Ω–µ–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∞—Ç—Ä–∏–±—É—Ç–∞—Ö –∫–ª–∞—Å—Å–∞
```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
class MyClass:
    def __init__(self):
        self.settings = Settings()  # ‚ùå –ü–õ–û–•–û

    def process(self):
        return self.settings.MAX_TOKENS
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
- –§–∏–∫—Å–∏—Ä—É–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞!
- –ü—Ä–µ–ø—è—Ç—Å—Ç–≤—É–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º—É –∏–∑–º–µ–Ω–µ–Ω–∏—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –£—Å–ª–æ–∂–Ω—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û –¥–ª—è —Ç–µ—Å—Ç–æ–≤
def some_function():
    print(Settings().MAX_TOKENS)

with Settings.local(MAX_TOKENS=1000, TEMPERATURE=0.5):
    result = some_function()
    # –í —ç—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ some_function –∏ Settings().MAX_TOKENS –≤–µ—Ä–Ω–µ—Ç 1000
```

---

–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–µ–ª–µ–≥—Ä–∞–º–∞ –≤ —Ç–∞–∫–æ–º –≤–∏–¥–µ.

–ù–µ –Ω—É–∂–Ω–æ –ø–æ–¥–∞–≤–ª—è—Ç—å –æ—à–∏–±–∫–∏ –≤–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä processing_errors –¥–æ–ª–∂–µ–Ω –µ–≥–æ 
–ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∏ –æ–Ω —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–º –º–µ—Å—Ç–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫, —è–≤–ª—è—è—Å—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º –º–µ—Å—Ç–æ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫, 
—á—Ç–æ–± –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫ –≤ –∫–∞–∂–¥–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ.

{–û–±—ä—è—Å–Ω–∏—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è —Ç–µ–ª–µ–≥—Ä–∞–º–º–∞ –∏–∑ project/infrastructure/utils/telegram.py}

–ü–æ—Ä—è–¥–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ –≤–∞–∂–µ–Ω!

```python
@check_auth
@timeout_with_retry
@processing_errors
@action_tracking_decorator("start_handler")
async def start_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.effective_user.id
    message = f"–ü—Ä–∏–≤–µ—Ç {user_id}! –≠—Ç–æ –ø—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¢–µ–ª–µ–≥—Ä–∞–º!"

    await update.message.reply_text(message)
```
