# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ï—Å—Ç—å –≥–æ—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –º–µ—Ç—Ä–∏–∫ —Å–æ–±–∏—Ä–∞–µ–º—ã—Ö –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ —á–µ—Ä–µ–∑ Prometheus.
–ú–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å —É –∫–æ–ª–ª–µ–≥ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ –¥–µ–≤–æ–ø—Å–æ–≤.
–¢–∞–∫–∂–µ –Ω–∞ —ç—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –≤ –¥–∞—à–±–æ—Ä–¥–∞—Ö –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –≤ —Ç–µ–ª–µ–≥—Ä–∞–º

–î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–µ–∫—Ü–∏–π –∫–æ–¥–∞.
–î–ª—è Telegram –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏ callback –µ—Å–ª–∏ —ç—Ç–æ telegram –±–æ—Ç.

## –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–µ–∫—Ü–∏–π –∫–æ–¥–∞

–î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä.

–ß—Ç–æ–±—ã —ç—Ç–∏ –ø—Ä–∏–º–∏—Ç–∏–≤—ã —Å–º–æ–≥–ª–∏ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –≤–æ–∑–Ω–∏–∫–ª–æ–≤–∞–Ω–∏—è exception, –≤–Ω—É—Ç—Ä–∏ —ç—Ç–∏—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –¥–æ–ª–∂–Ω—ã
–ø–æ–¥–∞–≤–ª—è—Ç—å—Å—è exception.

```python
from llm_common.prometheus import action_tracking, action_tracking_decorator

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–∞
with action_tracking("data_processing") as tracker:
    # –í–∞—à –∫–æ–¥
    processed_data = process_data()
    # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ç—Ä–µ–∫–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
    tracker.size(len(processed_data))
    
    # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ –æ—à–∏–±–∫—É
    tracker.to_fail()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
@action_tracking_decorator("myfeature_llm_call")
async def make_llm_request():
    # –í–∞—à –∫–æ–¥
    return result
```

## –ë–æ—Ç—ã Telegram

–•–æ—Ä–æ—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π —è–≤–ª—è–µ—Ç—Å—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤.

–ü—Ä–∏–º–µ–Ω—è–π–µ—Ç—Å—è –Ω–∞ —Ö–µ–Ω–¥–ª–µ—Ä—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback –∫–Ω–æ–ø–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –∏–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä—ã action_tracking –∏ action_tracking_decorator
–í –∫–∞—á–µ—Å—Ç–≤–µ –∏–º–µ–Ω–∏ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ —Å—É—Ñ—Ñ–∏–∫—Å "_handler" action_tracking(name="menu_handler"), —ç—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –æ—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –Ω–∞ 
–≥—Ä–∞—Ñ–∏–∫–µ —Ç–æ–ª—å–∫–æ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —Ö—ç–Ω–¥–ª–µ—Ä–æ–≤

## –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö action

–î–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ Telegram, —Å—É—Ñ—Ñ–∏–∫—Å "_handler"
–î–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –∑–∞–¥–∞—á, —Å—É—Ñ—Ñ–∏–∫—Å "_task"
–î–ª—è –≤—ã–∑–æ–≤–æ–≤ llm, —Å—É—Ñ—Ñ–∏–∫—Å "_llm_call"
–î–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–≥–µ–Ω—Ç–∞ llm, —Å—É—Ñ—Ñ–∏–∫—Å "_agent"

–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è –∏–º–µ–Ω: "_"

## üìñ API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### action_tracking(name: str)
–ö–æ–Ω—Ç–µ–∫—Å—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–º–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –∏ –æ—à–∏–±–æ—á–Ω—ã–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç—Ä–µ–∫–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### action_tracking_decorator(name: str)
–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–æ—Ä—É—Ç–∏–Ω, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ `action_tracking`.

## üîç –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

–í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `genapp_`:

#### HTTP –º–µ—Ç—Ä–∏–∫–∏:
- `genapp_http_requests_total` - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `genapp_http_request_duration_sec` - –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `genapp_http_request_size_bytes` - –†–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤

#### –ú–µ—Ç—Ä–∏–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π:
- `genapp_action_count_total` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- `genapp_action_duration_sec` - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π
- `genapp_action_size_total` - –†–∞–∑–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### Labels (—Ç–µ–≥–∏)

–ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç labels:
- http_requests_total ‚Üí method, status, resource, app_type, env, app
- http_request_duration_sec ‚Üí method, status, resource, app_type, env, app
- http_request_size_bytes ‚Üí resource, status, method, direction, app_type, env, app
- action_count_total ‚Üí name, status, env, app
- action_duration_sec ‚Üí name, env, app
- action_size_total ‚Üí name, env, app
