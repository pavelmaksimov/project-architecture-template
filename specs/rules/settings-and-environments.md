# Правила использования переменных окружения через project.settings.Settings

TODO: рассказать про SecretStr

## Правильное использование Settings

Объект `Settings` в файле `project/settings.py` реализован через `LazyInit`
и должен использоваться **только** через вызов класса `Settings().param_name`.

Это обеспечивает правильную работу ленивой инициализации, потокобезопасность и
возможность динамического переопределения настроек для тестирования.

### 1. Ленивая инициализация
`LazyInit` создает экземпляр настроек только при первом обращении
и переиспользует его в рамках одного контекста выполнения. Это обеспечивает:
- Отложенную загрузку конфигурации!
- Экономию памяти
- Переопределять настройки для тестов через `Settings.local(**kwargs)`

## ❌ АНТИПАТТЕРНЫ - что НЕ надо делать

### 1. Создание локальных переменных
```python
# ❌ НЕПРАВИЛЬНО
settings = Settings()
model_name = settings.LLM_MODEL_NAME
```

**Почему плохо:**
- Нарушает паттерн ленивой инициализации!
- Создает ненужную ссылку на объект
- Может привести к использованию устаревшего экземпляра при изменении контекста
- Усложняет тестирование с переопределением настроек

### 2. Использование в аргументах функций
```python
# ❌ НЕПРАВИЛЬНО
def process_data(settings=Settings()):
    return settings.MAX_TOKENS

# ❌ НЕПРАВИЛЬНО
def create_agent(config: SettingsValidator = Settings()):
    pass
```

**Почему плохо:**
- Создает экземпляр на момент определения функции, а не вызова
- Нарушает принцип единственного источника истины
- Делает функцию менее тестируемой
- Может привести к использованию устаревших настроек

### 3. Сохранение в атрибутах класса
```python
# ❌ НЕПРАВИЛЬНО
class MyClass:
    def __init__(self):
        self.settings = Settings()  # ❌ ПЛОХО

    def process(self):
        return self.settings.MAX_TOKENS
```

**Почему плохо:**
- Фиксирует экземпляр настроек на момент создания объекта!
- Препятствует динамическому изменению настроек
- Усложняет тестирование с мокированием настроек

## Тестирование с переопределением настроек

```python
# ✅ ПРАВИЛЬНО для тестов
def some_function():
    print(Settings().MAX_TOKENS)

with Settings.local(MAX_TOKENS=1000, TEMPERATURE=0.5):
    result = some_function()
    # В этом контексте some_function и Settings().MAX_TOKENS вернет 1000
```

## Переменные окружение проекта
{include [settings.py](../../project/settings.py)}